<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Macro Coach - Murat ASLI</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --primary: #38bdf8; --sec: #818cf8; --text: #f8fafc; --dim: #94a3b8; --success: #22c55e; --burn: #fb7185; --prot: #facc15; --carb: #a78bfa; --fat: #f472b6;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        .page { display: none; padding: 20px 15px 100px 15px; min-height: 100vh; box-sizing: border-box; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .card { background: var(--card); border-radius: 25px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 15px; }
        h1 { font-size: 1.3rem; text-align: center; margin-bottom: 20px; color: var(--primary); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 14px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 0.9rem; }
        
        /* Makro G√∂stergeleri */
        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 15px; }
        .m-box { padding: 10px; border-radius: 12px; text-align: center; font-size: 0.75rem; font-weight: bold; }
        .m-prot { background: rgba(250, 204, 21, 0.1); color: var(--prot); border: 1px solid var(--prot); }
        .m-carb { background: rgba(167, 139, 250, 0.1); color: var(--carb); border: 1px solid var(--carb); }
        .m-fat { background: rgba(244, 114, 182, 0.1); color: var(--fat); border: 1px solid var(--fat); }
        
        .btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; }
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: #1e293b; display: flex; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
        .tab-item { flex: 1; text-align: center; color: var(--dim); font-size: 0.6rem; cursor: pointer; }
        .tab-item.active { color: var(--primary); }
        
        .log-item { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 0.8rem; border-left: 4px solid var(--primary); }
        .del-btn { color: var(--burn); cursor: pointer; }
    </style>
</head>
<body>

<div id="p-goal" class="page active">
    <h1>HEDEF VE PROFƒ∞L</h1>
    <div class="card">
        <div class="grid">
            <div><label>G√úNCEL Kƒ∞LO</label><input type="number" id="w" value="73"></div>
            <div><label>YAƒû ORANI %</label><input type="number" id="fat_per" value="14"></div>
            <div><label>HEDEF A√áIK (kcal)</label><input type="number" id="goal_def" value="500"></div>
            <div><label>YA≈û</label><input type="number" id="age" value="34"></div>
        </div>
        <button class="btn" style="background:var(--primary)" onclick="saveProfile()">HEDEFƒ∞ SET ET</button>
    </div>
    
    <div class="card" id="macro-advice" style="display:none">
        <label>HEDEF ƒ∞√áƒ∞N G√úNL√úK ALMAN GEREKEN:</label>
        <div style="font-size: 1.5rem; font-weight: 900; color:var(--success); margin:10px 0;" id="target-cal-text">0 kcal</div>
        <div class="macro-grid">
            <div class="m-box m-prot">PROTEƒ∞N<br><span id="adv-prot">0g</span></div>
            <div class="m-box m-carb">KARB.<br><span id="adv-carb">0g</span></div>
            <div class="m-box m-fat">YAƒû<br><span id="adv-fat">0g</span></div>
        </div>
        <p style="font-size:0.65rem; color:var(--dim); margin-top:10px;">*Kas k√ºtlesini korumak i√ßin y√ºksek protein (2.2g/kg) baz alƒ±nmƒ±≈ütƒ±r.</p>
    </div>
</div>

<div id="p-sport" class="page">
    <h1>HAREKET</h1>
    <div class="card">
        <label>ADIM</label><input type="number" id="steps" value="0" onchange="save()">
        <br><br>
        <select id="sportSel"></select>
        <div class="grid" style="margin-top:10px">
            <input type="number" id="sportTime" value="30">
            <button class="btn" style="background:var(--burn); color:white" onclick="addItem('s')">YAK</button>
        </div>
    </div>
    <div id="sport-logs"></div>
</div>

<div id="p-food" class="page">
    <h1>BESLENME</h1>
    <div class="card">
        <select id="foodSel"></select>
        <div class="grid" style="margin-top:10px">
            <input type="number" id="foodQty" value="1" step="0.5">
            <button class="btn" style="background:var(--success); color:white" onclick="addItem('f')">YE</button>
        </div>
    </div>
    <div id="food-logs"></div>
</div>

<div id="p-history" class="page">
    <h1>GE√áMƒ∞≈û & ANALƒ∞Z</h1>
    <div id="history-list"></div>
</div>

<nav class="tab-bar">
    <div class="tab-item active" onclick="showPage('p-goal')">üéØ<br>HEDEF</div>
    <div class="tab-item" onclick="showPage('p-sport')">üèÉ<br>SPOR</div>
    <div class="tab-item" onclick="showPage('p-food')">üçé<br>BESƒ∞N</div>
    <div class="tab-item" onclick="showPage('p-history')">üìú<br>GE√áMƒ∞≈û</div>
</nav>

<script>
    const foodDB = [
        {n: "Tereyaƒülƒ± Omlet (3 Yum.)", c: 310, p: 21, k: 3, y: 22},
        {n: "Izgara Tavuk (150g)", c: 245, p: 45, k: 0, y: 5},
        {n: "Pirin√ß Pilavƒ± (Pors)", c: 350, p: 6, k: 75, y: 4},
        {n: "Yulaf Ezmesi (60g)", c: 220, p: 8, k: 36, y: 4},
        {n: "Lor Peyniri (100g)", c: 100, p: 18, k: 3, y: 1}
    ];
    const sportDB = [{n:"Aƒüƒ±rlƒ±k",c:7},{n:"Y√ºr√ºy√º≈ü",c:5},{n:"Ko≈üu",c:11}];

    let db = JSON.parse(localStorage.getItem('health_db_v12')) || {
        profile: {w:73, fat:14, goalDef:500, age:34, bmr:1700},
        days: {}
    };

    let today = new Date().toISOString().split('T')[0];
    if(!db.days[today]) db.days[today] = { steps:0, logs:[] };

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.tab-item').forEach(t => t.classList.toggle('active', t.getAttribute('onclick').includes(id)));
        if(id === 'p-history') renderHistory();
    }

    function saveProfile() {
        db.profile.w = parseFloat(document.getElementById('w').value);
        db.profile.fat = parseFloat(document.getElementById('fat_per').value);
        db.profile.goalDef = parseInt(document.getElementById('goal_def').value);
        db.profile.age = parseInt(document.getElementById('age').value);
        db.profile.bmr = (10 * db.profile.w) + (6.25 * 180) - (5 * db.profile.age) + 5; // 180 sabit boy varsayƒ±mƒ±
        save();
        updateGoalUI();
    }

    function updateGoalUI() {
        // Hesaplama: BMR + Adƒ±m(varsayƒ±lan 5000 adƒ±m = 200kcal) + Spor(varsayƒ±lan 300kcal) - Hedef A√ßƒ±k
        // Ama biz bunu anlƒ±k toplam yakƒ±ma g√∂re dinamik yapalƒ±m
        const currentTotalBurn = Math.round(db.profile.bmr + (db.days[today].steps * 0.04) + db.days[today].logs.filter(l=>l.type==='s').reduce((a,b)=>a+b.cal, 0));
        const targetCal = currentTotalBurn - db.profile.goalDef;
        
        const protG = Math.round(db.profile.w * 2.2); // Protein: 2.2g per kg
        const fatG = Math.round((targetCal * 0.25) / 9); // Yaƒü: %25 kcal
        const carbG = Math.round((targetCal - (protG * 4) - (fatG * 9)) / 4);

        document.getElementById('macro-advice').style.display = 'block';
        document.getElementById('target-cal-text').innerText = targetCal + " kcal";
        document.getElementById('adv-prot').innerText = protG + "g";
        document.getElementById('adv-carb').innerText = carbG + "g";
        document.getElementById('adv-fat').innerText = fatG + "g";
    }

    function addItem(type) {
        const sel = type === 'f' ? document.getElementById('foodSel') : document.getElementById('sportSel');
        const qty = type === 'f' ? document.getElementById('foodQty').value : document.getElementById('sportTime').value;
        const cal = Math.round(sel.value * qty);
        db.days[today].logs.push({ id: Date.now(), type, name: sel.options[sel.selectedIndex].text, cal });
        save();
        renderToday();
        updateGoalUI();
    }

    function save() {
        db.days[today].steps = document.getElementById('steps').value;
        localStorage.setItem('health_db_v12', JSON.stringify(db));
    }

    function renderToday() {
        const fLog = document.getElementById('food-logs');
        const sLog = document.getElementById('sport-logs');
        fLog.innerHTML = ""; sLog.innerHTML = "";
        db.days[today].logs.forEach(l => {
            const html = `<div class="log-item"><span>${l.name} (<b>${l.cal} kcal</b>)</span><span class="del-btn" onclick="deleteItem(${l.id})">‚úï</span></div>`;
            if(l.type === 'f') fLog.innerHTML += html; else sLog.innerHTML += html;
        });
    }

    function deleteItem(id) {
        db.days[today].logs = db.days[today].logs.filter(l => l.id !== id);
        save();
        renderToday();
        updateGoalUI();
    }

    window.onload = () => {
        document.getElementById('foodSel').innerHTML = foodDB.map(f=>`<option value="${f.c}">${f.n}</option>`).join('');
        document.getElementById('sportSel').innerHTML = sportDB.map(s=>`<option value="${s.c}">${s.n}</option>`).join('');
        document.getElementById('w').value = db.profile.w;
        document.getElementById('fat_per').value = db.profile.fat;
        document.getElementById('goal_def').value = db.profile.goalDef;
        document.getElementById('steps').value = db.days[today].steps;
        renderToday();
        updateGoalUI();
    };
</script>
</body>
</html>